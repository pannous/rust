#!/usr/bin/env rust
//! Test: Link against dynexport library at compile time (like C/C++)
//!
//! Compile library first:
//!   rustc --edition 2021 --crate-type cdylib test_dynexport_lib.rs -o libdynexport_test.dylib
//!
//! Then compile this with -L and -l flags:
//!   rustc --edition 2021 -L . -l dynexport_test test_dynexport_linked.rs
//!
//! Run with library path:
//!   DYLD_LIBRARY_PATH=. ./test_dynexport_linked   # macOS
//!   LD_LIBRARY_PATH=. ./test_dynexport_linked     # Linux

use std::ffi::{c_char, CStr, CString};

// Link against the library - just like C's -l flag
#[link(name = "dynexport_test")]
extern "C" {
    fn add(a: i32, b: i32) -> i32;
    fn multiply(a: f64, b: f64) -> f64;
    fn greet(name: *const c_char) -> *mut c_char;
    fn free_string(s: *mut c_char);
    fn factorial(n: u32) -> u64;
    fn sum_array(arr: *const i32, len: usize) -> i64;
}
